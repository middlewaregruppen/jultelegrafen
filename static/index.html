<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Christmas Postcard</title>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
      ::selection {
        background: rgba(255,255,0,0.5);
      }

      body {
        background: #de2f32; 
      }

      .footer {
        margin-top: 32px;
      }

      .form {
        display: inline-grid;
        width: 100%;
      }

      .form label {
        text-align: start;
      }

      .copyright {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        size: 10px;
        color: #053633; 
      }

      .status {
        text-align: start;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #360508;
        border: 2px solid;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        background-color: #ff9800;

      }

      .form input, textarea {
        font-family: "Comic Sans MS", "Comic Sans", cursive;
        font-size: 18px;
        border-radius: 8px;
        border: 2px solid #360508;
        padding: 12px;
        color: #9F0E17;
        margin-bottom: 12px;
      }

      .form button {
        margin-top: 16px;
        padding: 12px;
        font-family: "Comic Sans MS", "Comic Sans", cursive;
        border-radius: 8px;
        border: 2px solid #360508;
        background-color: #F3BB8A;
      }


      .form button:hover {
        background-color: #EF9D87;
      }
      .form button:active {
        background-color: #ff9800;
      }

      .form button:disabled {
        opacity: 0.6;
        cursor: default;
        transform: none;
      }

      a {
        color: #EF9D87;
        text-decoration: none;
      }
      a:visited {
        color: #EF9D87;
      }
      a:hover {
        color: #F3BB8A;
        text-decoration: underline;
      }

      input:focus,
      textarea:focus {
        outline: none;
        box-shadow: 0 0 0 2px #ff9800; /* custom visible focus */
      }

      .window {
        width: 340px;
        height: 340px;
        background: #a0d5d3;
        position: absolute;
        top: 30%;
        left: 50%;
        border-radius: 50%;
        margin-top: -60px;
        -webkit-transform: translate(-50%, -50%);
        -moz-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        -o-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        border: 10px solid #f8e7dc;
        overflow: hidden; }

      .santa {
        position: absolute;
        left: 50%;
        bottom: 0;
        -webkit-transform: translateX(-50%);
        -moz-transform: translateX(-50%);
        -ms-transform: translateX(-50%);
        -o-transform: translateX(-50%);
        transform: translateX(-50%); }
        .santa .body {
          width: 190px;
          height: 210px;
          background: #de2f32;
          position: relative;
          border-radius: 50%;
          top: 0;
          -webkit-animation: bodyLaugh 4s linear infinite;
          -moz-animation: bodyLaugh 4s linear infinite;
          -ms-animation: bodyLaugh 4s linear infinite;
          -o-animation: bodyLaugh 4s linear infinite;
          animation: bodyLaugh 4s linear infinite;
          -webkit-transform: translateY(50%);
          -moz-transform: translateY(50%);
          -ms-transform: translateY(50%);
          -o-transform: translateY(50%);
          transform: translateY(50%); }
          .santa .body:before {
            content: " ";
            width: 7px;
            height: 7px;
            background: #f7be10;
            border-radius: 50%;
            position: absolute;
            top: 35%;
            left: 50%;
            -webkit-transform: translate(-50%, -50%);
            -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            -o-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            box-shadow: 0px -18px 0px #f7be10, 0px 18px 0px #f7be10; }
        .santa .head {
          z-index: 2;
          position: absolute;
          bottom: 90px;
          left: 50%;
          -webkit-animation: headLaugh 4s linear infinite;
          -moz-animation: headLaugh 4s linear infinite;
          -ms-animation: headLaugh 4s linear infinite;
          -o-animation: headLaugh 4s linear infinite;
          animation: headLaugh 4s linear infinite;
          -webkit-transform: translateX(-50%);
          -moz-transform: translateX(-50%);
          -ms-transform: translateX(-50%);
          -o-transform: translateX(-50%);
          transform: translateX(-50%); }
          .santa .head .face {
            width: 120px;
            height: 130px;
            background: #edcab0;
            background: radial-gradient(#edcab0, #e9a982);
            border-radius: 50%;
            border: 3px solid #f8e7dc; }
            .santa .head .face .redhat .whitepart {
              position: absolute;
              left: 50%;
              top: 0;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%);
              width: 90%;
              height: 32px;
              background: #f8e7dc;
              border-radius: 50px;
              z-index: 4;
              box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 0.1); }
            .santa .head .face .redhat .redpart {
              width: 120px;
              height: 120px;
              background: #de2f32;
              position: absolute;
              top: -50px;
              left: 15px;
              border-radius: 50%;
              z-index: -1; }
              .santa .head .face .redhat .redpart:before {
                content: " ";
                width: 95px;
                height: 95px;
                position: absolute;
                left: 0;
                top: 12px;
                border-radius: 50%;
                box-shadow: inset -8px -1px 0px -5px rgba(0, 0, 0, 0.05); }
              .santa .head .face .redhat .redpart:after {
                content: " ";
                position: absolute;
                right: 0;
                top: 60px;
                background: #de2f32;
                width: 20px;
                height: 50px; }
            .santa .head .face .redhat .hatball {
              width: 38px;
              height: 38px;
              background: #f8e7dc;
              border-radius: 50%;
              z-index: 5;
              position: absolute;
              right: -20px;
              top: 40px;
              box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 0.1); }
            .santa .head .face .eyes {
              position: absolute;
              left: 50%;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%);
              top: 57px; }
              .santa .head .face .eyes:before, .santa .head .face .eyes:after {
                content: " ";
                position: absolute;
                width: 15px;
                height: 9px;
                top: 0;
                border: 5px solid #a8744f;
                border-width: 0;
                border-top-width: 5px;
                border-radius: 50%; }
              .santa .head .face .eyes:before {
                left: -28px; }
              .santa .head .face .eyes:after {
                right: -28px; }
            .santa .head .face .beard {
              width: 55px;
              height: 55px;
              background: #f8e7dc;
              border-radius: 50%;
              position: absolute;
              bottom: -30px;
              left: 50%;
              -webkit-animation: beardLaugh 4s linear infinite;
              -moz-animation: beardLaugh 4s linear infinite;
              -ms-animation: beardLaugh 4s linear infinite;
              -o-animation: beardLaugh 4s linear infinite;
              animation: beardLaugh 4s linear infinite;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%); }
              .santa .head .face .beard:before, .santa .head .face .beard:after {
                content: " ";
                width: 80px;
                height: 80px;
                background: #f8e7dc;
                border-radius: 50%;
                position: absolute;
                bottom: 15px; }
              .santa .head .face .beard:before {
                left: -40px; }
              .santa .head .face .beard:after {
                right: -40px; }
              .santa .head .face .beard .nouse {
                width: 25px;
                height: 20px;
                border-radius: 50%;
                background: #edcab0;
                position: absolute;
                z-index: 3;
                box-shadow: inset -3px -3px 0px #e9a982;
                left: 50%;
                -webkit-transform: translateX(-50%);
                -moz-transform: translateX(-50%);
                -ms-transform: translateX(-50%);
                -o-transform: translateX(-50%);
                transform: translateX(-50%);
                top: -42px; }
              .santa .head .face .beard .mouth {
                background: #a8744f;
                z-index: 3;
                position: absolute;
                width: 15px;
                height: 5px;
                border-bottom-right-radius: 80px 50px;
                border-bottom-left-radius: 80px 50px;
                left: 50%;
                top: 0;
                -webkit-animation: mouthLaugh 4s linear infinite;
                -moz-animation: mouthLaugh 4s linear infinite;
                -ms-animation: mouthLaugh 4s linear infinite;
                -o-animation: mouthLaugh 4s linear infinite;
                animation: mouthLaugh 4s linear infinite;
                -webkit-transform: translateX(-50%);
                -moz-transform: translateX(-50%);
                -ms-transform: translateX(-50%);
                -o-transform: translateX(-50%);
                transform: translateX(-50%); }
          .santa .head .ears:before, .santa .head .ears:after {
            content: " ";
            width: 20px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(#e9a982, #edcab0);
            position: absolute;
            top: 50%;
            z-index: -1; }
          .santa .head .ears:before {
            left: -8px;
            -webkit-transform: rotate(-10deg);
            -moz-transform: rotate(-10deg);
            -ms-transform: rotate(-10deg);
            -o-transform: rotate(-10deg);
            transform: rotate(-10deg); }
          .santa .head .ears:after {
            right: -8px;
            -webkit-transform: rotate(10deg);
            -moz-transform: rotate(10deg);
            -ms-transform: rotate(10deg);
            -o-transform: rotate(10deg);
            transform: rotate(10deg); }

      @font-face {
        font-family: 'Mountains of Christmas';
        font-style: normal;
        src: local("Mountains of Christmas"), local("MountainsofChristmas-Regular"), url(https://fonts.gstatic.com/s/mountainsofchristmas/v8/dVGBFPwd6G44IWDbQtPewylJhLDHyIrT3I5b5eGTHmw.woff2) format("woff2"); }
      .message {
        text-align: center;
        position: absolute;
        left: 50%;
        top: 30%;
        margin-top: 80px;
        -webkit-transform: translateX(-50%);
        -moz-transform: translateX(-50%);
        -ms-transform: translateX(-50%);
        -o-transform: translateX(-50%);
        transform: translateX(-50%);
        color: #f8e7dc;
        font-family: 'Mountains of Christmas'; }
        .message h1 {
          font-style: normal;
          font-size: 75px;
          margin-bottom: 0;
          white-space: nowrap; }
        .message h2 {
          margin: 0;
          font-size: 20px;
          text-align: center;
          white-space: nowrap; }
          .message h2 a {
            color: #f7be10;
            opacity: 0.8; }
            .message h2 a:hover {
              opacity: 1; }

      @-webkit-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-moz-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-ms-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-webkit-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-moz-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-ms-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-webkit-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-moz-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-ms-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-webkit-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @-moz-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @-ms-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
    </style>
  </head>
  <body>
    <div class="content" class="app" x-data="spaApp()" x-init="init()">
      <div class="window">
        <div class="santa">
          <div class="head">
            <div class="face">
              <div class="redhat">
                <div class="whitepart"></div>
                <div class="redpart"></div>
                <div class="hatball"></div>
              </div>
              <div class="eyes"></div>
              <div class="beard">
                <div class="nouse"></div>
                <div class="mouth"></div>
              </div>
            </div>
            <div class="ears"></div>
          </div>
          <div class="body"></div>
        </div>
      </div>
      <div class="message">
        <h1>God Jul!</h1>
        <h3>칐nskar Svenska Middlewaregruppen AB</h3>
        <div class="form">

          <div class="status" x-html="errorText" x-show="errorText.trim()"></div>
          <div class="status" x-html="statusText" x-show="statusText.trim()"></div>

          <label for="author" class="label">Fr친n</label>
          <input
            id="author"
            type="text"
            placeholder="Ditt namn eller f칬retag"
            x-model="messageAuthor"
          />

          <label for="content" class="label">Julh칛lsning</label>
          <textarea id="content" x-model="messageContent"></textarea>

          <button
            id="submit"
            type="button"
            class="primary"
            @click="postMessage"
            :disabled="isLoading || !messageContent.trim() || !messageAuthor.trim()"
          >
            <span x-show="!isLoading">Skicka</span>
            <span x-show="isLoading">Skickar...</span>
          </button>
        </div>
        <div class="footer">
          <div class="copyright">
          <p>
            <small>Skapad med 游눝 av oss som jobbar p친 Middlewaregruppen. <br/>K칛llkod och Licens finns p친 <a href="https://github.com/middlewaregruppen/jultelegrafen" target="_blank">GitHub</a> 
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
              </svg>
            </small>
          </p>
          <small class="copyright">CSS-tomten skapad av <a href="https://twitter.com/alireza29675" target="_blank">Alireza Sheikholmolouki</a></small>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    function spaApp() {
      return {
        // Reactive state
        displayMessage: 'Loading...',
        messageAuthor: '',
        messageContent: '',
        statusText: '',
        errorText: '',
        isLoading: false,
        isOnline: false,
        clientState: 'idle',
        init() {
          // Initial fetch from backend when SPA loads
          this.fetchMessage()
        },
        tomteSvordom() {
          const uttryck = [
            "Nissarnas n칬tkr칛m!",
            "Pepparkakspluttar!",
            "Tomtegr칬t och j칛rnspikar!",
            "Rensl칛dans rullr친n!",
            "Sk칛ggiga strumpor!",
            "Attans bananer och kn칛ck!",
            "Milde mistelkvast!",
            "Julgr칬tens gl칬d!",
            "Sn칬gubbens snurrflingor!",
            "Nisseknytt och polkagriskrumelurer!"
          ];
          const index = Math.floor(Math.random() * uttryck.length);
          return uttryck[index];
        },
        async postMessage() {

          this.isLoading = true
          this.clientState = 'syncing'
          try {
            const res = await fetch('/api/queue', {
              method: 'POST',
              body: JSON.stringify({
                content: this.messageContent,
                author: this.messageAuthor,
              })
            })
            if (!res.ok) throw new Error('HTTP ' + res.status)
            const data = await res.json()

            this.displayMessage = data.message || '(no message field)'
            this.statusText = this.tomteSvordom() + ' Vilket fint meddelande! <br/> Din julh칛lsning kommer visas p친 tomtens sk칛rm'
            this.isOnline = true
            this.clientState = 'synced'
            this.messageContent = ''
            this.messageAuthor = ''
          } catch (err) {
            this.displayMessage = 'Could not reach backend'
            this.statusText = 'Error: ' + err.message
            this.isOnline = false
            this.clientState = 'error'
            this.errorText = this.tomteSvordom() + " N친got gick snett: <br/>" + err.message 
          } finally {
            this.isLoading = false
          }
        },
        async fetchMessage() {
          this.errorText = ''
          this.isLoading = true
          this.clientState = 'syncing'
          try {
            const res = await fetch('/api/queue')
            if (!res.ok) throw new Error('HTTP ' + res.status)
            const data = await res.json()
            this.displayMessage = data.message || '(no message field)'
            this.isOnline = true
            this.clientState = 'synced'
          } catch (err) {
            this.errorText = this.tomteSvordom() + " N친got gick snett: <br/>" + err.message 
            this.displayMessage = 'Could not reach backend'
            this.isOnline = false
            this.clientState = 'error'
          } finally {
            this.isLoading = false
          }
        },
      }
    }
  </script>
</html>
