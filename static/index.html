<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <title>God Jul √ñnskar Middlewaregruppen</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap">
    <style>
      ::selection {
        background: rgba(255,255,0,0.5);
      }


      .error {
        font-family: var(--bs-font-monospace);

      }

      :root {
        /* Page-level colors (your own use) */
        --page-bg: #E2E7EA;          
        --page-surface: #f8e7dc;
        --page-text: #360508;  
        --accent-gold: #E7A374;
        --accent-ice: #a0d5d3;
        /* Bootstrap body */
        --bs-body-bg: var(--page-bg);
        --bs-body-color: var(--page-text);
        /* Bootstrap theme colors */
        --bs-primary: #F14E63;
        --bs-primary-rgb: 222, 47, 50;
        --bs-secondary: #0b3b2e;
        --bs-secondary-rgb: 11, 59, 46;
        --bs-warning: var(--accent-gold);
        --bs-warning-rgb: 247, 190, 16;
        --bs-info: var(--accent-ice);
        --bs-info-rgb: 160, 213, 211;
        /* Links */
        --bs-link-color: #f7be10;
        --bs-link-hover-color: #ffe066;

        --input-bg-color: #f1f3f5;
        --page-border-color: var(--accent-gold);
      }

      .form-check-input{
        border-color: var(--bs-btn-active-border-color);
      }
      .form-check-input:checked {
        background-color: var(--bs-primary);
        border-color: var(--bs-btn-active-border-color);
      }

      /* Primary = Santa red */
      .btn-primary {
        --bs-btn-bg: var(--bs-primary);
        --bs-btn-border-color: var(--bs-primary);
        --bs-btn-hover-bg: #ff3a3f;
        --bs-btn-hover-border-color: #ff3a3f;
        --bs-btn-active-bg: #b02125;
        --bs-btn-active-border-color: #b02125;
        --bs-btn-disabled-bg: var(--bs-primary);
        --bs-btn-disabled-border-color: var(--bs-primary);
      }
      /* Secondary = pine green (light) or frosty teal (dark) via vars above */
      .btn-secondary {
        --bs-btn-bg: var(--bs-secondary);
        --bs-btn-border-color: var(--bs-secondary);
        --bs-btn-hover-bg: #0f5040;
        --bs-btn-hover-border-color: #0f5040;
        --bs-btn-active-bg: #072b21;
        --bs-btn-active-border-color: #072b21;
        --bs-btn-disabled-bg: var(--bs-secondary);
        --bs-btn-disabled-border-color: var(--bs-secondary);
      }

      /* Use variables instead of hardcoded colors */
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: var(--page-bg);
        color: var(--page-text);
      }

      /* When in dark mode */
      [data-bs-theme="dark"] {
        /* Bootstrap body colors */
        /* --bs-secondary: #66704b; */
        /* --bs-primary: #555E3F; */
        --bs-body-bg: #121212;
        --bs-body-color: #f8f9fa;
        /* Your own page colors */
        --page-bg: #121212;
        --page-text: #fbd8da;
        --page-border-color: var(--accent-gold);
        --input-bg-color-active: #1f1f1f;
        --input-bg-color: #171717;
      }

      h1, h3 {
        font-family: 'Mountains of Christmas';
        font-style: normal;
        src: local("Mountains of Christmas"), local("MountainsofChristmas-Regular"), url(https://fonts.gstatic.com/s/mountainsofchristmas/v8/dVGBFPwd6G44IWDbQtPewylJhLDHyIrT3I5b5eGTHmw.woff2) format("woff2");
      }

      .footer {
        margin-top: 32px;
      }

      .form {
        display: inline-grid;
        width: 100%;
      }

      .form label {
        text-align: start;
      }

      .copyright {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        size: 10px;
        /* color: #053633; */
      }

      .status {
        text-align: start;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #360508;
        border: 2px solid;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        background-color: #ff9800;

      }

      .form-control {
        font-family: "Patrick Hand", system-ui, -apple-system, "Segoe UI", sans-serif;
        font-size: 18px;
        border-radius: 8px;
        border: 2px solid var(--page-border-color);
        padding: 12px;
        text-color: var(--page-text);
        margin-bottom: 12px;
        background-color: var(--input-bg-color);
      }

      .form-control:focus {
        outline: none;
        border-color: #ff9800;
        box-shadow: 0 0 0 2px #ff9800;
        background-color: var(--input-bg-color);
      }

      a {
        color: #EF9D87;
        text-decoration: none;
      }
      a:visited {
        color: #EF9D87;
      }
      a:hover {
        color: #F3BB8A;
        text-decoration: underline;
      }

      input:focus,
      textarea:focus {
        outline: none;
        box-shadow: 0 0 0 2px #ff9800; /* custom visible focus */
      }

      .window {
        width: 300px;
        height: 300px;
        background: #a0d5d3;
        position: relative;
        border-radius: 50%;
        margin: 0 auto 1rem;
        border: 10px solid #f8e7dc;
        overflow: hidden;
        transform-origin: top center;
        transition: border-radius 0.4s ease, width 0.4s ease, height 0.4s ease, transform 0.4s ease;
      }

      .window-expanded {
        width: 100%;
        max-width: 640px;
        aspect-ratio: 16 / 9;
        height: auto;
        border-radius: 24px;
        transform: none !important;
      }


      .window-expanded {
        width: 100%;
        max-width: 640px;
        aspect-ratio: 16 / 9;
        height: auto;
        border-radius: 24px;
        transform: none !important;
      }

      .santa-messages {
        position: absolute;
        inset: 0;
        z-index: 3;
        background: #a0d5d3;
      }

      .santa-video {
        position: absolute;
        inset: 0;
        z-index: 3;
        background: #000;
        overflow: hidden;
      }

      .santa-video-loader {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .santa-video-feed {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .santa-message-viewport {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      .santa-message-stack {
        height: 100%;
        display: flex;
        flex-direction: column;
        transition: transform 0.6s ease-in-out;
      }

      .santa-message-line {
        min-height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        text-align: center;
        font-family: 'Patrick Hand', system-ui, -apple-system, "Segoe UI", sans-serif;
        font-size: 1.1rem;
        line-height: 1.4;
        color: #360508;
      }

      .santa {
        position: absolute;
        left: 50%;
        bottom: 0;
        -webkit-transform: translateX(-50%);
        -moz-transform: translateX(-50%);
        -ms-transform: translateX(-50%);
        -o-transform: translateX(-50%);
        transform: translateX(-50%); }
        .santa .body {
          width: 190px;
          height: 210px;
          background: #de2f32;
          position: relative;
          border-radius: 50%;
          top: 0;
          -webkit-animation: bodyLaugh 4s linear infinite;
          -moz-animation: bodyLaugh 4s linear infinite;
          -ms-animation: bodyLaugh 4s linear infinite;
          -o-animation: bodyLaugh 4s linear infinite;
          animation: bodyLaugh 4s linear infinite;
          -webkit-transform: translateY(50%);
          -moz-transform: translateY(50%);
          -ms-transform: translateY(50%);
          -o-transform: translateY(50%);
          transform: translateY(50%); }
          .santa .body:before {
            content: " ";
            width: 7px;
            height: 7px;
            background: #f7be10;
            border-radius: 50%;
            position: absolute;
            top: 35%;
            left: 50%;
            -webkit-transform: translate(-50%, -50%);
            -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            -o-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            box-shadow: 0px -18px 0px #f7be10, 0px 18px 0px #f7be10; }
        .santa .head {
          z-index: 2;
          position: absolute;
          bottom: 90px;
          left: 50%;
          -webkit-animation: headLaugh 4s linear infinite;
          -moz-animation: headLaugh 4s linear infinite;
          -ms-animation: headLaugh 4s linear infinite;
          -o-animation: headLaugh 4s linear infinite;
          animation: headLaugh 4s linear infinite;
          -webkit-transform: translateX(-50%);
          -moz-transform: translateX(-50%);
          -ms-transform: translateX(-50%);
          -o-transform: translateX(-50%);
          transform: translateX(-50%); }
          .santa .head .face {
            width: 120px;
            height: 130px;
            background: #edcab0;
            background: radial-gradient(#edcab0, #e9a982);
            border-radius: 50%;
            border: 3px solid #f8e7dc; }
            .santa .head .face .redhat .whitepart {
              position: absolute;
              left: 50%;
              top: 0;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%);
              width: 90%;
              height: 32px;
              background: #f8e7dc;
              border-radius: 50px;
              z-index: 4;
              box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 0.1); }
            .santa .head .face .redhat .redpart {
              width: 120px;
              height: 120px;
              background: #de2f32;
              position: absolute;
              top: -50px;
              left: 15px;
              border-radius: 50%;
              z-index: -1; }
              .santa .head .face .redhat .redpart:before {
                content: " ";
                width: 95px;
                height: 95px;
                position: absolute;
                left: 0;
                top: 12px;
                border-radius: 50%;
                box-shadow: inset -8px -1px 0px -5px rgba(0, 0, 0, 0.05); }
              .santa .head .face .redhat .redpart:after {
                content: " ";
                position: absolute;
                right: 0;
                top: 60px;
                background: #de2f32;
                width: 20px;
                height: 50px; }
            .santa .head .face .redhat .hatball {
              width: 38px;
              height: 38px;
              background: #f8e7dc;
              border-radius: 50%;
              z-index: 5;
              position: absolute;
              right: -20px;
              top: 40px;
              box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 0.1); }
            .santa .head .face .eyes {
              position: absolute;
              left: 50%;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%);
              top: 57px; }
              .santa .head .face .eyes:before, .santa .head .face .eyes:after {
                content: " ";
                position: absolute;
                width: 15px;
                height: 9px;
                top: 0;
                border: 5px solid #a8744f;
                border-width: 0;
                border-top-width: 5px;
                border-radius: 50%; }
              .santa .head .face .eyes:before {
                left: -28px; }
              .santa .head .face .eyes:after {
                right: -28px; }
            .santa .head .face .beard {
              width: 55px;
              height: 55px;
              background: #f8e7dc;
              border-radius: 50%;
              position: absolute;
              bottom: -30px;
              left: 50%;
              -webkit-animation: beardLaugh 4s linear infinite;
              -moz-animation: beardLaugh 4s linear infinite;
              -ms-animation: beardLaugh 4s linear infinite;
              -o-animation: beardLaugh 4s linear infinite;
              animation: beardLaugh 4s linear infinite;
              -webkit-transform: translateX(-50%);
              -moz-transform: translateX(-50%);
              -ms-transform: translateX(-50%);
              -o-transform: translateX(-50%);
              transform: translateX(-50%); }
              .santa .head .face .beard:before, .santa .head .face .beard:after {
                content: " ";
                width: 80px;
                height: 80px;
                background: #f8e7dc;
                border-radius: 50%;
                position: absolute;
                bottom: 15px; }
              .santa .head .face .beard:before {
                left: -40px; }
              .santa .head .face .beard:after {
                right: -40px; }
              .santa .head .face .beard .nouse {
                width: 25px;
                height: 20px;
                border-radius: 50%;
                background: #edcab0;
                position: absolute;
                z-index: 3;
                box-shadow: inset -3px -3px 0px #e9a982;
                left: 50%;
                -webkit-transform: translateX(-50%);
                -moz-transform: translateX(-50%);
                -ms-transform: translateX(-50%);
                -o-transform: translateX(-50%);
                transform: translateX(-50%);
                top: -42px; }
              .santa .head .face .beard .mouth {
                background: #a8744f;
                z-index: 3;
                position: absolute;
                width: 15px;
                height: 5px;
                border-bottom-right-radius: 80px 50px;
                border-bottom-left-radius: 80px 50px;
                left: 50%;
                top: 0;
                -webkit-animation: mouthLaugh 4s linear infinite;
                -moz-animation: mouthLaugh 4s linear infinite;
                -ms-animation: mouthLaugh 4s linear infinite;
                -o-animation: mouthLaugh 4s linear infinite;
                animation: mouthLaugh 4s linear infinite;
                -webkit-transform: translateX(-50%);
                -moz-transform: translateX(-50%);
                -ms-transform: translateX(-50%);
                -o-transform: translateX(-50%);
                transform: translateX(-50%); }
          .santa .head .ears:before, .santa .head .ears:after {
            content: " ";
            width: 20px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(#e9a982, #edcab0);
            position: absolute;
            top: 50%;
            z-index: -1; }
          .santa .head .ears:before {
            left: -8px;
            -webkit-transform: rotate(-10deg);
            -moz-transform: rotate(-10deg);
            -ms-transform: rotate(-10deg);
            -o-transform: rotate(-10deg);
            transform: rotate(-10deg); }
          .santa .head .ears:after {
            right: -8px;
            -webkit-transform: rotate(10deg);
            -moz-transform: rotate(10deg);
            -ms-transform: rotate(10deg);
            -o-transform: rotate(10deg);
            transform: rotate(10deg); }

      @font-face {
        font-family: 'Mountains of Christmas';
        font-style: normal;
        src: local("Mountains of Christmas"), local("MountainsofChristmas-Regular"), url(https://fonts.gstatic.com/s/mountainsofchristmas/v8/dVGBFPwd6G44IWDbQtPewylJhLDHyIrT3I5b5eGTHmw.woff2) format("woff2"); }
      .message {
        text-align: center;
        position: absolute;
        left: 50%;
        top: 30%;
        margin-top: 80px;
        -webkit-transform: translateX(-50%);
        -moz-transform: translateX(-50%);
        -ms-transform: translateX(-50%);
        -o-transform: translateX(-50%);
        transform: translateX(-50%);
        color: #f8e7dc;
        font-family: 'Mountains of Christmas'; }
        .message h1 {
          font-style: normal;
          font-size: 75px;
          margin-bottom: 0;
          white-space: nowrap; }
        .message h2 {
          margin: 0;
          font-size: 20px;
          text-align: center;
          white-space: nowrap; }
          .message h2 a {
            color: #f7be10;
            opacity: 0.8; }
            .message h2 a:hover {
              opacity: 1; }

      @-webkit-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-moz-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-ms-keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @keyframes bodyLaugh {
        0% {
          top: 0px; }

        2% {
          top: -3px; }

        4% {
          top: 0px; }

        8% {
          top: -3px; }

        10% {
          top: 0px; }

        12% {
          top: -3px; }

        14% {
          top: 0px; }

        18% {
          top: -3px; }

        20% {
          top: 0px; }

        22% {
          top: -3px; }

        24% {
          top: 0px; }

        28% {
          top: -3px; }

        30% {
          top: 0px; }

        100% {
          top: 0px; } }
      @-webkit-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-moz-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-ms-keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @keyframes beardLaugh {
        0% {
          bottom: -28px; }

        2% {
          bottom: -30px; }

        4% {
          bottom: -28px; }

        8% {
          bottom: -30px; }

        10% {
          bottom: -28px; }

        12% {
          bottom: -30px; }

        14% {
          bottom: -28px; }

        18% {
          bottom: -30px; }

        20% {
          bottom: -28px; }

        22% {
          bottom: -30px; }

        24% {
          bottom: -28px; }

        28% {
          bottom: -30px; }

        30% {
          bottom: -28px; }

        100% {
          bottom: -28px; } }
      @-webkit-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-moz-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-ms-keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @keyframes headLaugh {
        0% {
          bottom: 83px; }

        45% {
          bottom: 83px; }

        50% {
          bottom: 90px; }

        92% {
          bottom: 90px; }

        98% {
          bottom: 83px; }

        100% {
          bottom: 83px; } }
      @-webkit-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @-moz-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @-ms-keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }
      @keyframes mouthLaugh {
        0% {
          width: 20px; }

        45% {
          width: 20px; }

        50% {
          width: 15px; }

        92% {
          width: 15px; }

        98% {
          width: 20px; }

        100% {
          width: 20px; } }


      .app {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">

      <main class="main my-4" class="app" x-data="spaApp()" x-init="init()">
        <div class="text-center">

          <div class="row">

            <!-- Left padding on large screens -->
            <div class="col-lg-4">
            </div>
            
            <div class="col container-fluid santa-col m-3">

              <!-- Santa -->
              <div class="santa-wrapper">
                <div class="santa-wrapper-inner">

                  <div class="window">

                    <div
                      class="santa-video"
                      x-show="!showSantaMessages && showFeed"
                    >
                       <template x-if="loading">
                         <div class="santa-video-loader">
                           <div class="spinner-border text-light" role="status">
                             <span class="visually-hidden">Laddar video...</span>
                           </div>
                         </div>
                       </template>

                      <template x-if="error">
                        <div class="text-light small text-center px-2" x-text="error"></div>
                      </template>
                       <template x-if="url && !error">
                         <img
                           x-bind:src="url"
                           alt="Julkamera"
                           class="santa-video-feed"
                           @load="onStreamLoad"
                           @error="onStreamError"
                           @click="videoExpanded = !videoExpanded"
                         />
                       </template>

                    </div>

                    <!-- <div -->
                    <!--   class="santa-messages" -->
                    <!--   x-show="showSantaMessages" -->
                    <!--   x-transition.opacity -->
                    <!-- > -->
                    <!--   <div class="santa-message-viewport"> -->
                    <!--     <div -->
                    <!--       class="santa-message-stack" -->
                    <!--       :style="'transform: translateY(-' + (santaTickerIndex * 100) + '%)'" -->
                    <!--     > -->
                    <!--       <template x-if="!santaMessages.length"> -->
                    <!--         <div class="santa-message-line"> -->
                    <!--           Inga julh√§lsningar √§nnu -->
                    <!--         </div> -->
                    <!--       </template> -->
                    <!--       <template x-for="(msg, index) in santaMessages" :key="msg.id || index"> -->
                    <!--         <div class="santa-message-line" x-text="formatSantaMessage(msg)"></div> -->
                    <!--       </template> -->
                    <!--     </div> -->
                    <!--   </div> -->
                    <!-- </div> -->

                    <div
                      class="santa"
                      x-show="!showSantaMessages ||¬†!showFeed"
                      @click="enableCamera()"
                    >
                      <div class="head">
                        <div class="face">
                          <div class="redhat">
                            <div class="whitepart"></div>
                            <div class="redpart"></div>
                            <div class="hatball"></div>
                          </div>
                          <div class="eyes"></div>
                          <div class="beard">
                            <div class="nouse"></div>
                            <div class="mouth"></div>
                          </div>
                        </div>
                        <div class="ears"></div>
                      </div>
                      <div class="body"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Form -->
              <div class="row">
                <h1 class="fs-1">God Jul!</h1>
                <h3 class="fs-4">√ñnskar Svenska Middlewaregruppen AB</h3>
                <div class="form">

                  <div class="alert alert-danger" x-html="errorText" role="alert" x-show="errorText.trim()"></div>
                  <div class="alert alert-success" x-html="statusText" role="alert" x-show="statusText.trim()"></div>

                  <div class="mb-3">
                    <input
                      class="form-control form-control-lg"
                      id="author"
                      type="text"
                      placeholder="Ditt namn eller f√∂retag"
                      x-model="messageAuthor"
                    />
                  </div>

                  <div class="mb-3">
                    <textarea id="content" placeholder="Skriv din julh√§lsning h√§r" class="form-control form-control-lg" rows="3" x-model="messageContent"></textarea>
                  </div>

                  <button 
                    id="submit" 
                    type="button" 
                    class="btn btn-primary btn-lg" 
                    @click="postMessage"
                    :disabled="isLoading || !messageContent.trim() || !messageAuthor.trim()"
                  >
                    <span x-show="!isLoading">Skicka</span>
                    <span x-show="isLoading">Skickar...</span>
                  </button>
                </div>

                <!-- Footer -->
                <div class="footer">
                  <div class="copyright">
                    <p>
                      <small>Skapad med üíõ av oss som jobbar p√• Middlewaregruppen. <br/>K√§llkod och Licens finns p√• <a href="https://github.com/middlewaregruppen/jultelegrafen" target="_blank">GitHub</a> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
                        </svg>
                      </small>
                    </p>
                    <small class="copyright">CSS-tomten skapad av <a href="https://twitter.com/alireza29675" target="_blank">Alireza Sheikholmolouki</a></small>
                  </div>
                  <div class="d-flex justify-content-center m-3">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="darkModeSwitch"
                        x-model="darkMode"
                        @change="applyTheme"
                      >
                      <label class="form-check-label" for="darkModeSwitch">
                        M√∂rkt l√§ge
                      </label>
                    </div>
                  </div>
                </div>
              <!-- End form -->
              </div>
            </div>

            <!-- Right padding on large screens -->
            <div class="col-lg-4">
            </div>

          </div>
        </div>
      </main>
    </div>
  </body>
  <script>
    function spaApp() {
      return { 
        // Camera state
        streamURL: "http://stream-proxy.middleware.se/api/stream.mjpeg?src=rtmp_stream_low",
        url: "",
        error: null,
        loading: false,
        showFeed: false,
        feedLoaded: false,
        videoExpanded: false,
        async load() {
          this.error = null;
          this.loading = true;
          this.showFeed = true;
          this.url = this.streamURL;
        },
        onStreamLoad() {
          this.loading = false;
          this.feedLoaded = true;
        },
        onStreamError(event) {
          this.loading = false;
          this.feedLoaded = false;
          this.error = 'Str√∂mmen kunde inte laddas.';
          console.error('Stream image error', event);
        },
        enableCamera() {
          this.load();
        },
        disableCamera() {
          this.url = "";
          this.showFeed = false;
          this.feedLoaded = false;
          this.loading = false;
          this.videoExpanded = false;
        },
        // Reactive state
        displayMessage: 'Loading...',
        messageAuthor: '',
        messageContent: '',
        statusText: '',
        errorText: '',
        isLoading: false,
        isOnline: false,
        clientState: 'idle',
        darkMode: false,

        // Santa message state
        showSantaMessages: false,
        santaMessages: [],
        currentSantaMessage: '',
        santaTickerIndex: 0,
        santaTickerTimer: null,
        santaFetchTimer: null,
        init() {
          // Set theme based on saved preference before doing anything else
          const saved = localStorage.getItem('theme');
          this.darkMode = saved === 'dark';
          this.applyTheme();
          // Initial fetch from backend when SPA loads
          this.fetchMessage()
        },

        toggleSantaMessages() {
          this.showSantaMessages = !this.showSantaMessages

          if (this.showSantaMessages) {
            this.startSantaPolling()
          } else {
            this.stopSantaPolling()
          }
        },

        applyTheme() {
          const theme = this.darkMode ? 'dark' : 'light';
          document.documentElement.setAttribute('data-bs-theme', theme);
          localStorage.setItem('theme', theme);
        },
        formatSantaMessage(entry) {
          if (!entry) return ''
          const content = (entry.content || '').trim()
          const author = (entry.author || '').trim()
          if (content && author) return `${content} ‚Äî ${author}`
          if (content) return content
          if (author) return `H√§lsning fr√•n ${author}`
          return ''
        },

        startSantaPolling() {
          this.stopSantaPolling()

          this.fetchSantaMessages().then(() => {
            this.updateSantaTicker()
          })

          this.santaFetchTimer = setInterval(() => {
            this.fetchSantaMessages().then(() => {
              this.updateSantaTicker()
            })
          }, 20000)

          this.santaTickerTimer = setInterval(() => {
            this.advanceSantaMessage()
          }, 5000)
        },

        stopSantaPolling() {
          if (this.santaFetchTimer) {
            clearInterval(this.santaFetchTimer)
            this.santaFetchTimer = null
          }
          if (this.santaTickerTimer) {
            clearInterval(this.santaTickerTimer)
            this.santaTickerTimer = null
          }
        },

        updateSantaTicker() {
          if (!this.santaMessages.length) {
            this.currentSantaMessage = 'Inga julh√§lsningar √§nnu'
            this.santaTickerIndex = 0
            return
          }
          if (this.santaTickerIndex >= this.santaMessages.length) {
            this.santaTickerIndex = 0
          }
          this.currentSantaMessage = this.formatSantaMessage(
            this.santaMessages[this.santaTickerIndex]
          )
        },

        advanceSantaMessage() {
          if (!this.santaMessages.length) return
          this.santaTickerIndex = (this.santaTickerIndex + 1) % this.santaMessages.length
          this.updateSantaTicker()
        },

        async fetchSantaMessages() {
          try {
            const res = await fetch('/api/queue')
            if (!res.ok) {
              const msg = await res.text()
              throw new Error(msg || ('HTTP ' + res.status))
            }

            const data = await res.json() || {}
            const list = Object.values(data)

            this.santaMessages = list

            if (!this.currentSantaMessage && list.length) {
              this.santaTickerIndex = 0
              this.currentSantaMessage = this.formatSantaMessage(list[0])
            }
          } catch (err) {
            console.error('Failed to fetch Santa messages:', err)
            if (!this.currentSantaMessage) {
              this.currentSantaMessage =
                this.tomteSvordom() + ' Jag kunde inte h√§mta julh√§lsningar just nu.'
            }
          }
        },

        tomteSvordom() {
          const uttryck = [
            "Nissarnas n√∂tkr√§m!",
            "Pepparkakspluttar!",
            "Tomtegr√∂t och j√§rnspikar!",
            "Rensl√§dans rullr√•n!",
            "Sk√§ggiga strumpor!",
            "Attans bananer och kn√§ck!",
            "Milde mistelkvast!",
            "Julgr√∂tens gl√∂d!",
            "Sn√∂gubbens snurrflingor!",
            "Nisseknytt och polkagriskrumelurer!"
          ];
          const index = Math.floor(Math.random() * uttryck.length);
          return uttryck[index];
        },
        async postMessage() {

          this.isLoading = true
          this.clientState = 'syncing'
          this.statusText = '';
          try {
            const res = await fetch('/api/queue', {
              method: 'POST',
              body: JSON.stringify({
                content: this.messageContent,
                author: this.messageAuthor,
              })
            })
            if (!res.ok) {
              const errorBody = await res.text()
              throw new Error(errorBody || ('HTTP ' + res.status))
            } 
            const data = await res.json()

            this.displayMessage = data.message || '(no message field)'
            this.statusText = this.tomteSvordom() + ' Vilket fint meddelande! <br/> Din julh√§lsning kommer visas p√• tomtens sk√§rm'
            this.isOnline = true
            this.clientState = 'synced'
            this.messageContent = ''
            this.messageAuthor = ''
          } catch (err) {
            this.displayMessage = 'Could not reach backend'
            this.isOnline = false
            this.clientState = 'error'
            this.errorText = this.tomteSvordom() + " N√•got gick snett: <br/><span class=\"error\">" + (err.message || 'Ok√§nt fel') + "</span>"
          } finally {
            this.isLoading = false
          }
        },
        async fetchMessage() {
          this.errorText = ''
          this.isLoading = true
          this.clientState = 'syncing'
          try {
            const res = await fetch('/api/queue')
            if (!res.ok) throw new Error('HTTP ' + res.status)
            const data = await res.json()
            this.displayMessage = data.message || '(no message field)'
            this.isOnline = true
            this.clientState = 'synced'
          } catch (err) {
            this.errorText = this.tomteSvordom() + " N√•got gick snett: <br/><span class=\"error\">" + err.message + "</span>"
            this.displayMessage = 'Could not reach backend'
            this.isOnline = false
            this.clientState = 'error'
          } finally {
            this.isLoading = false
          }
        },
      }
    }

    // Scale Santa window to fill its Bootstrap column while keeping proportions
    function resizeSantaWindow() {
      var col = document.querySelector('.santa-col');
      if (!col) return;
       var santaWindow = col.querySelector('.window');
       if (!santaWindow) return;
       if (santaWindow.classList.contains('window-expanded')) return;

      var originalSize = 340; // original design size in px
      var available = col.clientWidth;
      if (!available) return;

      var scale = available / originalSize;
      santaWindow.style.transform = 'scale(' + scale + ')';

      // Push content below Santa down so it isn't hidden by the scaled circle
      var baseMargin = 16; // ~1rem
      var extra = Math.max(0, originalSize * (scale - 1));
      santaWindow.style.marginBottom = (baseMargin + extra) + 'px';
    }

    window.addEventListener('resize', resizeSantaWindow);
    window.addEventListener('DOMContentLoaded', resizeSantaWindow);
  </script>
</html>
